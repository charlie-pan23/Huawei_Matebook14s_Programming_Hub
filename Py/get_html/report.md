# 从巨鲸地址中筛选并分析出沉淀资产的地址    

## 巨鲸的定义   
...

## 对沉淀地址判断的量化标准
我们定义最后一次交易发生在6个月之前且交易金额高于10,000美元的地址为巨鲸地址中的沉淀地址。        

考虑到如果具体分析每一个地址来判断是否是沉淀地址，数千个数据显然超出了人能够胜任的范畴。若使用人工智能，则需要大量的前期训练，这需要大量的算力消耗，且很多犯罪分子为了隐藏主要交易地址，会将其分成小笔交易，进行大规模的多次交易，这会导致追踪过程具有极高的时间和空间复杂度。因此，我们从未隐藏的沉淀地址入手，探索沉淀地址的初步筛选。          

将沉淀时间规定在6个月以上的考虑如下：     
* 加密货币市场的周期普遍较短，6个月已经能够判定为较长的沉淀     
* 加密货币的高波动性导致大部分未与稳定币锚定的加密货币的市值会产生较大的波动，六个月的时间框架足够包含至少一个短期市场周期，这样可以确保在此期间未发生资金移动的地址不仅仅是短期的市场行为反应。    

将交易金额阈值规定在 10,000$ 的考虑如下：      

* 巨鲸的要求是持有大量资产，由于之前已经进行过巨鲸的筛选，判断沉淀地址只需要判断其是否进行了大额交易并进行了长时间沉淀，而 10,000$ 能够恰好排除小额交易同时让大部分符合条件的大额交易进入最后的筛选。

## 具体步骤

1. 获取相应区块链浏览器的API，通过python，使用requests库发送请求，并依次收取每一个巨鲸地址的所有交易信息。    
2. 解析返回数据包，筛选符合条件的交易，在相应 _.csv_ 文件记录hash，value等数据。     
3. 从所有巨鲸的最后一次大额交易中初步筛选出，哪个巨鲸地址成为了沉淀地址

## 准备工作
* 详细了解了各区块链浏览器通过API请求的不同请求类型。   
确定了对本连主币使用txlist类型请求，对外来币使用tokentx类型请求。

* 确定返回数据的格式以及含义，提取关键变量。    
确定了相对于美元的交易金额计算公式为：     
`value_USD = value / 10 ^ tokenDecimal  * Price` 

* 确定了使用 python 进行主要开发。      
使用pandas库进行表格处理，requests库进行网络请求处理，使用Matplotlib库进行图像绘制。

    

## 程序设计
### 初步设想
从相应的.csv文件中获取地址 ---> 向网站请求 ---> 获取数据包 ---> 按时间从晚到早对比选出第一笔金额大于 10,000$ 的交易 ---> 收取这笔交易的其他信息 ---> 填入.csv表格对应行的空列 ---> 人工通过excel的公式自动填充来筛选潜在沉淀地址

### 程序调试
1. 鉴于请求速度相对较慢，开始对使用多线程进行请求的尝试。

2. 由于使用了免费的API，网站对当前ip地址请求频率做了限制，每秒不大于五次，故增加了每次请求之后的休眠时间，同时减少了请求的线程。而后考虑到请求发送速度的问题，采用了每秒一次五线程同时请求的异步策略。

3. 当测试到BTCB这类不与USD 1:1 锚定的加密货币时，发现request得来的value值并不是“value_USD”，而是数量“amount” ，故编写Get_Price.py将常见的加密货币与USD的汇率存入表格文件，并在实际使用时调用。

4. 测试中发现不同的加密货币在不同链上的小数位数不同，大部分为18，也有小部分为 6，8，10 等，于是将固定参数18更改为每次读入的参数 tokenDecimal 即小数位数。

## 输出结果

输出即在原有表格数据列右边添加以下列：    
| 列名 | 备注 |
| --- | --- |
|_Date Time (UTC)_| 最后一次大额交易的UTC时间 |    
|_Txhash_| 交易哈希值|   
|_Value (USD)_|交易金额（根据amount基于当前汇率计算得）|     
|_From_| - |    
|_To_| - |    
|_Transfer Type_| 进账/出账（in/out）|

最后一列 _沉淀地址_ 需手动使用公式填充    
公式如下：    
` =IF(ISBLANK(F2),"",IF(F2<DATE(2024,1,1),"yes","")) `